# Aqua Vulnerability Filter

A solution for filtering ignored vulnerabilities from Aqua Security scan reports and optimizing data for Splunk integration.

## Overview

This package provides tools to:

1. Filter out ignored vulnerabilities from Aqua Security scan reports
2. Process HTML reports to fix severity values and replace variables
3. Generate enhanced, modern visualization dashboards
4. Filter and optimize scan data for Splunk ingestion, including:
   - Filtering by severity (CVSS ≥ 7.0)
   - Delta reporting (only new vulnerabilities)
   - Focusing on policy violations
   - Creating Splunk-optimized event format

## Installation

### Option 1: Install as Python Package

```bash
pip install -e .
```

### Option 2: Use Scripts Directly

```bash
pip install -r requirements.txt
```

## Quick Start

1. Place your Aqua Security scan reports in the `examples/input` directory
2. Run the example script:

```bash
cd examples
chmod +x run_filtering.sh
./run_filtering.sh
```

3. View the results in the `examples/output` directory

## Configuration

You can configure which vulnerabilities to ignore in several ways:

### 1. Configuration File

Edit `config/ignored_cves_config.json` to specify CVEs to ignore:

```json
{
  "ignored_cves": [
    "CVE-2025-27789",
    "CVE-2024-45590"
  ],
  "comment": "These CVEs have been marked as ignored in the Aqua UI"
}
```

### 2. Environment Variables

Set the `AQUA_IGNORED_CVES` environment variable:

```bash
export AQUA_IGNORED_CVES="CVE-2025-27789,CVE-2024-45590"
```

### 3. Command-Line Arguments

Specify CVEs directly on the command line:

```bash
python scripts/filter_aqua_reports.py --ignored-cves CVE-2025-27789 CVE-2024-45590
```

### 4. Automatic Detection (Default)

By default, the system will automatically detect vulnerabilities marked as ignored in the Aqua UI.

## Splunk Integration

### Optimizing Scan Data for Splunk

Filter Aqua scan data based on severity, identify new issues, and focus on policy violations:

```bash
python scripts/filter_for_splunk.py input/aqua-scan.json output/filtered-for-splunk.json --min-severity 7.0 --delta-only --previous-scan previous/aqua-scan.json
```

This generates three files:
- `filtered-for-splunk.json` - Complete filtered report
- `filtered-for-splunk_splunk.json` - Splunk-optimized line-by-line events
- `filtered-for-splunk_summary.json` - Summary of filtering results

### Sending Data to Splunk

Send the filtered data to Splunk using the HTTP Event Collector (HEC):

```bash
python scripts/send_to_splunk.py output/filtered-for-splunk_splunk.json --hec-url https://splunk.example.com:8088/services/collector --token YOUR-HEC-TOKEN
```

### Splunk Integration Benefits

1. **Optimized Payload Size**: Reduces payload size to avoid HEC limits
2. **Simplified Structure**: Flattens complex nested structures
3. **Focused Data**: Only sends high-severity issues (CVSS ≥ 7.0)
4. **Delta Reporting**: Sends only new vulnerabilities when compared to previous scans
5. **Policy Violations**: Option to only include issues that violate policies

## Documentation

For more information, see:

- [Vulnerability Filter Solution Guide](docs/Vulnerability_Filter_Solution_Guide.md) - Overview for users
- [Technical Implementation Details](docs/Technical_Implementation_Details.md) - Technical details for developers

## Requirements

- Python 3.9 or later
- BeautifulSoup4 library (for HTML report filtering)
- Requests library (for Splunk integration)

## Integration with CI/CD

This solution can be integrated into your CI/CD pipeline. See the documentation for details.

## License

Copyright © 2024 